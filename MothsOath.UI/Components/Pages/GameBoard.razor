@page "/"
@rendermode InteractiveServer 
@inject GameStateManager GameState 

<PageTitle>Moth's Oath</PageTitle>

<h1>Moth's Oath - Tabuleiro de Jogo</h1>

<div class="game-board-grid">
    <section class="board-area">
        @if (GameState.Player != null)
        {
            <h2>Inimigos</h2>
            @if (GameState.Enemies.Any())
            {
                <div class="enemy-container">
                    @foreach (var enemy in GameState.Enemies)
                    {
                        <div class="enemy-card" @onclick="() => TargetEnemy(enemy)">
                            <p><strong>@enemy.Name</strong></p>
                            <p>HP: @enemy.CurrentHP / @enemy.MaxHP</p>
                        </div>
                    }
                </div>
            }
            else
            {
                <p>Nenhum inimigo no campo.</p>
            }
        }
        else
        {
            <p>O jogo ainda não começou.</p>
        }
    </section>

</div>

<hr />

<button class="start-button floating-start-button" @onclick="StartGame">Iniciar Novo Combate</button>

@if (GameState.Player != null && GameState.Player.Hand.Any())
{
    <div class="player-hand-container">
        <h3>Sua Mão</h3>
        <div class="hand">
            @foreach (var card in GameState.Player.Hand)
            {
                <div @onclick="() => SelectCard(card)">
                    <CardComponent CardData="card" />
                </div>
            }
        </div>
    </div>
}

@code {

    private BaseCard? selectedCard; 

    private void SelectCard(BaseCard card)
    {
        selectedCard = card;
        Console.WriteLine($"Carta selecionada: {card.Name}");
    }

    private void TargetEnemy(Enemy enemy)
    {
        if (selectedCard == null)
        {
            Console.WriteLine("Nenhuma carta selecionada para atacar.");
            return;
        }

        Console.WriteLine($"Inimigo alvo: {enemy.Name}");
        GameState.PlayCard(selectedCard, enemy);
        selectedCard = null; 
    }

    private void StartGame()
    {
        GameState.StartNewCombat();
    }
}